<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EVO Reels - Split View Responsivo</title>
  
  <!-- Inclui o Tailwind CSS via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Inclui os estilos do Swiper -->
  <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css" />
  
  <style>
    /* * CSS Customizado: Necess√°rio para Spinner, Pagina√ß√£o, e Scrubber Handle */
    * { margin:0; padding:0; box-sizing:border-box; }

    /* Estilos base para garantir 100% de altura/largura em dispositivos m√≥veis */
    body, html { 
      height: 100%; 
      width: 100%;
      background: #000; 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
      overflow: hidden; /* Mant√©m o overflow oculto para o feed vertical */
    }
    
    /* * Spinner: O indicador de carregamento. */
    .spinner {
      border-top-color: #fff;
      -webkit-animation: spinner 1s linear infinite;
      animation: spinner 1s linear infinite;
    }
    @-webkit-keyframes spinner {
      0% { -webkit-transform: rotate(0deg); }
      100% { -webkit-transform: rotate(360deg); }
    }
    @keyframes spinner {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Barra de progresso do v√≠deo (Container para clique) */
    .evo-reels-video-progress {
      position: absolute; 
      bottom: 9px; 
      left: 20px; 
      right: 20px;
      height: 10px; 
      background: transparent; 
      z-index: 20; 
      cursor: pointer;
      padding-top: 3.5px;
    }
    .evo-reels-progress-line {
      height: 3px; 
      background: rgba(255,255,255,0.3); 
      border-radius: 2px;
      position: relative;
    }
    .evo-reels-progress-fill {
      width: 0%; 
      height: 100%; 
      background: white; 
      border-radius: 2px;
      transition: width 0.1s linear;
    }
    .evo-reels-progress-handle {
        position: absolute;
        top: 50%;
        left: 0;
        transform: translate(-50%, -50%);
        width: 10px; 
        height: 10px;
        background: white;
        border-radius: 50%;
        opacity: 0; 
        transition: opacity 0.1s;
    }

    /* Estilos de zoom de lupa (Desktop: Hover/Mousemove) */
    .slide-zoom img {
      transition: transform 0.4s ease;
      transform-origin: center center;
    }
    .slide-zoom:hover img {
        transform: scale(2.2);
    }
    
    /* ** Destaque e Z-INDEX da Pagina√ß√£o ** */
    .swiper-pagination-horizontal.swiper-pagination-bullets {
        bottom: 140px; 
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        justify-content: center;
        gap: 9px;
        z-index: 30; 
        position: absolute;
    }
    .swiper-pagination-bullet {
        width: 10px; 
        height: 10px; 
        background: rgba(255,255,255,0.5); 
        opacity: 1;
        transition: all 0.3s;
    }
    .swiper-pagination-bullet-active {
        background: white; 
        transform: scale(1.3); 
        border: 1px solid rgba(0,0,0,0.2);
    }
    /* Estilo do modal customizado (mantido para classes modais) */
    .modal.bottom-0 { bottom: 0; }
  </style>
</head>
<body class="bg-black text-white">

    <!-- Container centralizador para Split View no Desktop (784px de largura total) -->
    <div id="main-split-container" class="w-full h-full md:flex md:flex-row md:justify-center md:items-center md:gap-0 
         md:h-[683px] md:w-[784px] md:absolute md:top-1/2 md:left-1/2 md:-translate-x-1/2 md:-translate-y-1/2">
        
        <!-- ** SWIPER VERTICAL (Feed) - Esquerda (384x683px) ** -->
        <div class="swiper evo-reels-vertical-swiper w-full h-full relative overflow-hidden flex-shrink-0 
                    md:w-[384px] md:rounded-l-[16px] md:shadow-2xl md:shadow-black/70" id="evo-reels-vertical-swiper">
          <div class="swiper-wrapper">
            
            <!-- ** Slide Vertical 1: Jaqueta Branca (ID: 1) ** -->
            <div class="swiper-slide evo-reels-reel-container w-full h-full relative" data-is-video="true" data-product-id="1">
              
              <!-- BARRA DE PROGRESso DO V√çDEO -->
              <div class="evo-reels-video-progress" id="evo-reels-video-progress-1">
                <div class="evo-reels-progress-line">
                    <div class="evo-reels-progress-fill" id="evo-reels-progress-fill-1"></div>
                    <div class="evo-reels-progress-handle" id="evo-reels-progress-handle-1"></div>
                </div>
              </div>
              
              <div class="swiper evo-reels-horizontal-swiper w-full h-full relative" id="evo-reels-horizontal-swiper-1">
                <div class="swiper-wrapper">
                  
                  <!-- Slide Horizontal 1: V√≠deo -->
                  <div class="swiper-slide evo-reels-video-slide relative">
                    
                    <!-- Indicador de Carregamento -->
                    <div class="loading-indicator absolute inset-0 flex items-center justify-center bg-black/60 transition-opacity duration-300 z-10" id="loading-1">
                      <div class="spinner border-4 border-gray-700 border-solid h-10 w-10 rounded-full"></div>
                    </div>
                    
                    <!-- O v√≠deo preenche o container (384x683px) -->
                    <video id="evo-reels-video-1" preload="metadata" loop playsinline muted class="w-full h-full object-cover">
                      <source src="https://maksantos.com.br/wp-content/uploads/2024/12/VIDEO-MAKSANTOS-REELS-32-.mp4" type="video/mp4">
                    </video>
                    <div class="play-pause-overlay absolute inset-0 z-10 cursor-pointer" id="evo-reels-video-overlay-1"></div>
                    <div class="play-pause-btn absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-16 h-16 bg-black/60 backdrop-blur-md rounded-full flex items-center justify-center text-white text-3xl opacity-0 transition-opacity duration-300 pointer-events-none z-10" id="evo-reels-play-pause-btn-1">Pause</div>
                  </div>
                  
                  <!-- Slides Horizontal 2, 3, 4: Fotos com zoom lupa -->
                  <div class="swiper-slide slide-zoom cursor-crosshair relative"><img src="https://agweb.co.in/fashion-hub/images/white-top-with-jacket.jpeg" alt="Foto 1" class="w-full h-full object-cover"></div>
                  <div class="swiper-slide slide-zoom cursor-crosshair relative"><img src="https://agweb.co.in/fashion-hub/images/white-top-with-jacket.jpeg" alt="Foto 2" class="w-full h-full object-cover"></div>
                  <div class="swiper-slide slide-zoom cursor-crosshair relative"><img src="https://agweb.co.in/fashion-hub/images/white-top-with-jacket.jpeg" alt="Foto 3" class="w-full h-full object-cover"></div>
                  
                </div>
                <!-- Pontinhos (Pagina√ß√£o Horizontal) -->
                <div class="swiper-pagination"></div>
              </div>
              
              <!-- Overlays (Controlos e Informa√ß√µes) -->
              <div class="top-controls absolute top-4 right-4 flex gap-3 z-30">
                <button class="control-btn w-11 h-11 bg-black/70 backdrop-blur-sm rounded-full flex items-center justify-center text-white text-xl cursor-pointer border-none" id="evo-reels-sound-btn-1" onclick="toggleSound(1)">Volume Off</button>
                <button class="control-btn w-11 h-11 bg-black/70 backdrop-blur-sm rounded-full flex items-center justify-center text-white text-xl cursor-pointer border-none" onclick="window.close()">X</button>
              </div>
              
              <!-- FOOTER MOBILE (OCULTAR EM DESKTOP) -->
              <div class="footer pointer-events-auto cursor-pointer z-20 md:hidden absolute bottom-0 left-0 right-0 p-5 bg-gradient-to-t from-black/80 via-transparent/40 to-transparent" onclick="openModal(1)">
                <div class="profile flex items-center gap-2 mb-1">
                  <img src="https://agweb.co.in/images/portfolio/favicon/apple-icon-60x60.png" alt="Profile" class="w-9 h-9 rounded-full border-2 border-white">
                  <div>
                    <div class="product-name font-bold text-base">Jaqueta Branca Premium</div>
                    <div class="product-price text-sm font-semibold text-green-400">R$ 399,90</div>
                  </div>
                </div>
                <div class="desc text-sm leading-snug opacity-90 mt-1">Frete gr√°tis acima de R$299 ‚Ä¢ Edi√ß√£o limitada ‚Ä¢ Todo Brasil</div>
              </div>

              <!-- ACTIONS - VIS√çVEL EM MOBILE E DESKTOP -->
              <div class="actions absolute right-4 bottom-28 flex flex-col gap-6 pointer-events-auto z-20">
                <div><button class="btn buy bg-white text-black font-bold text-xs rounded-lg w-16 h-12 flex items-center justify-center border-none">COMPRAR</button></div>
                <div><button class="btn bg-white/10 backdrop-blur-md border border-white/20 w-14 h-14 rounded-full flex items-center justify-center text-xl">‚ù§Ô∏è</button><div class="count text-xs text-center mt-1">8.2K</div></div>
                <div><button class="btn bg-white/10 backdrop-blur-md border border-white/20 w-14 h-14 rounded-full flex items-center justify-center text-xl">üí¨</button><div class="count text-xs text-center mt-1">655K</div></div>
                <div><button class="btn bg-white/10 backdrop-blur-md border border-white/20 w-14 h-14 rounded-full flex items-center justify-center text-xl">üîó</button><div class="count text-xs text-center mt-1">8.2K</div></div>
              </div>
            </div>
            
            <!-- ** Slide Vertical 2: Novo Reel/Produto (T√™nis Vermelho) (ID: 2) ** -->
            <div class="swiper-slide evo-reels-reel-container w-full h-full relative" data-is-video="false" data-product-id="2">
              <div class="swiper evo-reels-horizontal-swiper w-full h-full relative" id="evo-reels-horizontal-swiper-2">
                <div class="swiper-wrapper">
                  
                  <!-- Slides Horizontal: Apenas Imagens para o segundo produto -->
                  <div class="swiper-slide slide-zoom cursor-crosshair relative">
                      <!-- Indicador de Carregamento -->
                      <div class="loading-indicator absolute inset-0 flex items-center justify-center bg-black/60 transition-opacity duration-300 z-10" id="loading-2">
                          <div class="spinner border-4 border-gray-700 border-solid h-10 w-10 rounded-full"></div>
                      </div>
                      <img src="https://images.unsplash.com/photo-1542291026-7eec264c27fc?q=80&w=2670&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="T√™nis Vermelho 1" class="w-full h-full object-cover">
                  </div>
                  <div class="swiper-slide slide-zoom cursor-crosshair relative">
                      <!-- Indicador de Carregamento -->
                      <div class="loading-indicator absolute inset-0 flex items-center justify-center bg-black/60 transition-opacity duration-300 z-10" id="loading-3">
                          <div class="spinner border-4 border-gray-700 border-solid h-10 w-10 rounded-full"></div>
                      </div>
                      <img src="https://images.unsplash.com/photo-1605342415174-8d4ed0c5c364?q=80&w=2670&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="T√™nis Vermelho 2" class="w-full h-full object-cover">
                  </div>
                  
                </div>
                <!-- Pontinhos (Pagina√ß√£o Horizontal) -->
                <div class="swiper-pagination"></div>
              </div>
              
              <!-- Overlays (Controlos e Informa√ß√µes) -->
              <div class="top-controls absolute top-4 right-4 flex gap-3 z-30">
                  <button class="control-btn w-11 h-11 bg-black/70 backdrop-blur-sm rounded-full flex items-center justify-center text-white text-xl cursor-pointer border-none">X</button>
              </div>
              
              <!-- FOOTER MOBILE (OCULTAR EM DESKTOP) -->
              <div class="footer pointer-events-auto cursor-pointer z-20 md:hidden absolute bottom-0 left-0 right-0 p-5 bg-gradient-to-t from-black/80 via-transparent/40 to-transparent" onclick="openModal(2)">
                <div class="profile flex items-center gap-2 mb-1">
                  <img src="https://agweb.co.in/images/portfolio/favicon/apple-icon-60x60.png" alt="Profile" class="w-9 h-9 rounded-full border-2 border-white">
                  <div>
                    <div class="product-name font-bold text-base">T√™nis Lifestyle Vermelho</div>
                    <div class="product-price text-sm font-semibold text-green-400">R$ 559,99</div>
                  </div>
                </div>
                <div class="desc text-sm leading-snug opacity-90 mt-1">Design exclusivo ‚Ä¢ Lan√ßamento da cole√ß√£o outono/inverno.</div>
              </div>

              <!-- ACTIONS - VIS√çVEL EM MOBILE E DESKTOP -->
              <div class="actions absolute right-4 bottom-28 flex flex-col gap-6 pointer-events-auto z-20">
                <div><button class="btn buy bg-white text-black font-bold text-xs rounded-lg w-16 h-12 flex items-center justify-center border-none">COMPRAR</button></div>
                <div><button class="btn bg-white/10 backdrop-blur-md border border-white/20 w-14 h-14 rounded-full flex items-center justify-center text-xl">‚ù§Ô∏è</button><div class="count text-xs text-center mt-1">12.5K</div></div>
                <div><button class="btn bg-white/10 backdrop-blur-md border border-white/20 w-14 h-14 rounded-full flex items-center justify-center text-xl">üí¨</button><div class="count text-xs text-center mt-1">980</div></div>
                <div><button class="btn bg-white/10 backdrop-blur-md border border-white/20 w-14 h-14 rounded-full flex items-center justify-center text-xl">üîó</button><div class="count text-xs text-center mt-1">5.1K</div></div>
              </div>
            </div>
            
          </div>
        </div>
        
        <!-- ** PAINEL DE DETALHES FIXO (DIREITA - 400px) ** -->
        <div id="desktop-details-panel" class="hidden md:block md:w-[400px] md:h-[683px] bg-white p-8 overflow-y-auto rounded-r-[16px] shadow-2xl text-black flex-shrink-0">
            <h2 class="text-3xl font-bold mb-4" id="details-title"></h2>
            <div class="text-4xl font-extrabold mb-6 text-green-600" id="details-price"></div>
            <p class="text-gray-700 leading-relaxed mb-8" id="details-description"></p>
            
            <button class="w-full py-4 bg-indigo-600 text-white font-bold rounded-full text-lg hover:bg-indigo-700 transition mb-6">
                ADICIONAR AO CARRINHO
            </button>

            <div class="flex flex-col gap-4 text-sm text-gray-700 border-t pt-4">
                <div class="flex items-center gap-2"><span class="text-indigo-500">üõí</span> <span id="details-stock">Em estoque</span></div>
                <div class="flex items-center gap-2"><span class="text-indigo-500">üì¶</span> <span id="details-shipping">Frete gr√°tis acima de R$299</span></div>
                <div class="flex items-center gap-2"><span class="text-indigo-500">üí≥</span> <span id="details-payment">Parcelamento em at√© 12x sem juros.</span></div>
            </div>
        </div>
    </div>


  <!-- Modal Mobile (Jaqueta) -->
  <div class="modal fixed bottom-[-100%] left-0 w-full h-full bg-white rounded-t-[32px] p-5 transition-all duration-400 ease-in-out shadow-xl z-[999] overflow-y-auto" id="modal1">
    <div class="flex justify-between items-center pb-2">
      <button class="back-btn bg-none border-none text-xl cursor-pointer p-2 font-bold" onclick="closeModal()">‚úï</button>
    </div>
    <div class="drag-bar w-10 h-1.5 bg-gray-300 rounded-md mx-auto my-2"></div>
    <img src="https://agweb.co.in/fashion-hub/images/white-top-with-jacket.jpeg" class="modal-img w-full h-[340px] object-cover rounded-xl mb-4" alt="Jaqueta">
    <h3 class="modal-title text-2xl font-bold mb-2">Jaqueta Branca Premium</h3>
    <div class="modal-price text-3xl font-extrabold mb-3">R$ 399,90</div>
    <p class="modal-desc text-base leading-relaxed text-gray-600 mb-8">Tecido premium italiano, acabamento perfeito. Frete gr√°tis acima de R$299 ‚Ä¢ Parcelamento em at√© 12x.</p>
    <button class="buy-btn bg-black text-white border-none py-4 rounded-full text-lg font-bold w-full cursor-pointer">COMPRAR AGORA</button>
  </div>

  <!-- Modal Mobile (T√™nis) -->
  <div class="modal fixed bottom-[-100%] left-0 w-full h-full bg-white rounded-t-[32px] p-5 transition-all duration-400 ease-in-out shadow-xl z-[999] overflow-y-auto" id="modal2">
    <div class="flex justify-between items-center pb-2">
      <button class="back-btn bg-none border-none text-xl cursor-pointer p-2 font-bold" onclick="closeModal()">‚úï</button>
    </div>
    <div class="drag-bar w-10 h-1.5 bg-gray-300 rounded-md mx-auto my-2"></div>
    <img src="https://images.unsplash.com/photo-1542291026-7eec264c27fc?q=80&w=2670&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" class="modal-img w-full h-[340px] object-cover rounded-xl mb-4" alt="T√™nis">
    <h3 class="modal-title text-2xl font-bold mb-2">T√™nis Lifestyle Vermelho</h3>
    <div class="modal-price text-3xl font-extrabold mb-3">R$ 559,99</div>
    <p class="modal-desc text-base leading-relaxed text-gray-600 mb-8">Lan√ßamento da cole√ß√£o, solado com tecnologia de amortecimento e design moderno. Leve o estilo para onde for!</p>
    <button class="buy-btn bg-black text-white border-none py-4 rounded-full text-lg font-bold w-full cursor-pointer">COMPRAR AGORA</button>
  </div>

  <!-- Inclui o script do Swiper -->
  <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
  
  <script>
    // ** DADOS MOCKADOS DOS PRODUTOS **
    const productsData = {
        '1': {
            title: "Jaqueta Branca Premium",
            price: "R$ 399,90",
            description: "Tecido premium italiano, acabamento perfeito. Esta jaqueta √© a pe√ßa chave para qualquer esta√ß√£o, combinando estilo e durabilidade. Edi√ß√£o limitada.",
            stock: "Em estoque, poucas unidades.",
            shipping: "Frete gr√°tis acima de R$299",
            payment: "Parcelamento em at√© 12x sem juros.",
        },
        '2': {
            title: "T√™nis Lifestyle Vermelho",
            price: "R$ 559,99",
            description: "Lan√ßamento da cole√ß√£o, solado com tecnologia de amortecimento e design moderno. Leve o estilo para onde for! Dispon√≠vel em v√°rios tamanhos.",
            stock: "Dispon√≠vel para pr√©-venda.",
            shipping: "Envio imediato.",
            payment: "Parcelamento em at√© 6x sem juros.",
        }
    };

    // ** Vari√°veis Globais **
    const video = document.getElementById('evo-reels-video-1');
    const progressFill = document.getElementById('evo-reels-progress-fill-1');
    const progressHandle = document.getElementById('evo-reels-progress-handle-1');
    const videoOverlay = document.getElementById('evo-reels-video-overlay-1');
    const playPauseBtn = document.getElementById('evo-reels-play-pause-btn-1');
    const soundBtn = document.getElementById('evo-reels-sound-btn-1');
    const videoProgressContainer = document.getElementById('evo-reels-video-progress-1');
    const desktopDetailsPanel = document.getElementById('desktop-details-panel');


    // ** Fun√ß√£o de Renderiza√ß√£o do Painel de Detalhes (Desktop) **
    function renderDetailsPanel(productId) {
        const product = productsData[productId];
        if (!product || window.innerWidth < 768) return; // S√≥ renderiza no desktop

        document.getElementById('details-title').textContent = product.title;
        document.getElementById('details-price').textContent = product.price;
        document.getElementById('details-description').textContent = product.description;
        document.getElementById('details-stock').textContent = product.stock;
        document.getElementById('details-shipping').textContent = product.shipping;
        document.getElementById('details-payment').textContent = product.payment;
    }


    // ** Vari√°veis de Zoom/Touch **
    const touchTimestamps = new WeakMap();
    const doubleTapDelay = 300; 
    let initialPinchDistance = 0;
    let currentScale = 1;
    let imgElement = null;

    // Fun√ß√£o auxiliar para calcular a dist√¢ncia entre dois toques (para Pin√ßar)
    function getDistance(touch1, touch2) {
        return Math.sqrt(
            Math.pow(touch2.clientX - touch1.clientX, 2) +
            Math.pow(touch2.clientY - touch1.clientY, 2)
        );
    }

    // Fun√ß√£o auxiliar para esconder o loading spinner
    function hideLoading(id) {
        const indicator = document.getElementById('loading-' + id);
        if (indicator) {
            indicator.classList.add('opacity-0');
            setTimeout(() => indicator.style.display = 'none', 300);
        }
    }

    // Ocultar spinners de imagem ao carregar
    document.querySelectorAll('.slide-zoom img').forEach((img, index) => {
        const loadingId = index + 2; 
        img.addEventListener('load', () => hideLoading(loadingId));
    });

    // Ocultar spinner do v√≠deo
    video.addEventListener('canplaythrough', () => hideLoading(1));

    // ** 1. Configura√ß√£o do Swiper Vertical (Feed de Reels) **
    const verticalSwiper = new Swiper('#evo-reels-vertical-swiper', {
      direction: 'vertical',
      slidesPerView: 1,
      spaceBetween: 0,
      mousewheel: true,
      keyboard: { enabled: true },
      on: {
        init: function() {
            // Renderiza o primeiro produto ao iniciar no Desktop
            const initialSlide = this.slides[this.activeIndex];
            const initialProductId = initialSlide.getAttribute('data-product-id');
            renderDetailsPanel(initialProductId);
        },
        slideChangeTransitionStart: function() {
          // Pausa o v√≠deo anterior (Slide 0) se estiver ativo
          if (this.previousIndex === 0) {
            video.pause();
            videoProgressContainer.style.display = 'none'; 
          }
        },
        slideChangeTransitionEnd: function() {
          const activeSlide = this.slides[this.activeIndex];
          const productId = activeSlide.getAttribute('data-product-id');

          // Renderiza o novo produto no painel Desktop
          renderDetailsPanel(productId);

          // L√≥gica de V√≠deo e Progresso (Apenas Slide 0)
          if (this.activeIndex === 0) {
            video.currentTime = 0;
            video.play().catch(e => console.log("V√≠deo n√£o p√¥de ser reproduzido automaticamente."));
            video.muted = (soundBtn.textContent === "Volume Off");
            videoProgressContainer.style.display = 'block'; 
          } else {
             videoProgressContainer.style.display = 'none'; 
          }
          
          const currentHorizontalSwiper = activeSlide.querySelector('.evo-reels-horizontal-swiper').swiper;
          if (currentHorizontalSwiper) {
             currentHorizontalSwiper.slideTo(0);
          }
        },
      }
    });

    // ** 2. Configura√ß√£o do Swiper Horizontal (Imagens/V√≠deos de um Reel) **
    document.querySelectorAll('.evo-reels-horizontal-swiper').forEach(function(element) {
      new Swiper(element, {
        slidesPerView: 1,
        spaceBetween: 0,
        pagination: {
          el: element.querySelector(".swiper-pagination"),
          clickable: true,
        },
        keyboard: { enabled: true },
        on: {
          slideChange: function() {
            if (verticalSwiper.activeIndex === 0) {
              if (this.activeIndex === 0) {
                video.currentTime = 0;
                video.play();
                videoProgressContainer.style.opacity = 1;
              } else {
                video.pause();
                videoProgressContainer.style.opacity = 0;
              }
            }
            
            const prevSlide = this.slides[this.previousIndex];
            if (prevSlide && prevSlide.classList.contains('slide-zoom') && 
                (prevSlide.classList.contains('touch-zoom-active-fixed') || prevSlide.classList.contains('touch-zoom-active'))) {
                 resetZoom(prevSlide); // Desativa o zoom e reseta a escala
            }
          }
        }
      });
    });

    // ** 3. L√≥gica do V√≠deo **
    // Configura√ß√µes iniciais do primeiro v√≠deo
    video.muted = true;
    video.play().catch(e => console.log("V√≠deo n√£o p√¥de ser reproduzido automaticamente."));

    video.addEventListener('timeupdate', () => {
      if (video.duration) {
        const percent = (video.currentTime / video.duration) * 100;
        progressFill.style.width = percent + '%';
        progressHandle.style.left = percent + '%';
      }
    });
    
    // Fun√ß√£o unificada para Seeking (Avan√ßar/Retroceder)
    function handleVideoSeeking(e) {
        const clientX = e.clientX || (e.changedTouches && e.changedTouches[0].clientX);
        if (!clientX) return;

        const rect = videoProgressContainer.getBoundingClientRect();
        const percent = (clientX - rect.left) / rect.width;
        
        if (video.duration) {
            video.currentTime = percent * video.duration;
        }
    }

    // Eventos de in√≠cio (touchstart, mousedown) para mostrar o handle
    videoProgressContainer.addEventListener('mousedown', () => progressHandle.style.opacity = 1);
    videoProgressContainer.addEventListener('touchstart', () => progressHandle.style.opacity = 1);

    // Eventos de seek (Click/TouchEnd)
    videoProgressContainer.addEventListener('click', handleVideoSeeking);
    videoProgressContainer.addEventListener('touchend', (e) => {
        handleVideoSeeking(e);
        progressHandle.style.opacity = 0; // Esconde no final do toque
    });
    
    // Eventos de fim (mouseup, touchend) para esconder o handle
    videoProgressContainer.addEventListener('mouseup', () => progressHandle.style.opacity = 0);

    videoOverlay.addEventListener('click', (e) => {
      e.stopPropagation();
      if (video.paused) {
        video.play();
        playPauseBtn.textContent = 'Pause';
      } else {
        video.pause();
        playPauseBtn.textContent = 'Play';
      }
      playPauseBtn.classList.add('opacity-100');
      setTimeout(() => playPauseBtn.classList.remove('opacity-100'), 800);
    });

    // Controle de Som
    function toggleSound(id) {
        const targetVideo = document.getElementById('evo-reels-video-' + id);
        const targetBtn = document.getElementById('evo-reels-sound-btn-' + id);
        if (targetVideo) {
            targetVideo.muted = !targetVideo.muted;
            targetBtn.textContent = targetVideo.muted ? "Volume Off" : "Volume On";
        }
    }
    window.toggleSound = toggleSound;

    // ** 4. L√≥gica do Zoom (Pin√ßar PRIM√ÅRIO, Duplo Toque APENAS RESET) **
    
    function resetZoom(parentSlide) {
        const img = parentSlide.querySelector('img');
        
        parentSlide.classList.remove('touch-zoom-active', 'touch-zoom-active-fixed');
        parentSlide.classList.remove('swiper-no-swiping'); 
        
        img.style.transform = 'scale(1)'; 
        img.style.transformOrigin = '';

        parentSlide.removeEventListener('touchmove', handleZoomPan, { passive: false });
        currentScale = 1;
        initialPinchDistance = 0;
        imgElement = null;
    }

    function handleZoomPan(e) {
        if (e.touches.length !== 1 || !(e.currentTarget.classList.contains('touch-zoom-active') || e.currentTarget.classList.contains('swiper-no-swiping'))) return;

        e.preventDefault(); 
        e.stopPropagation();

        const parentSlide = e.currentTarget;
        const img = parentSlide.querySelector('img');
        const touch = e.touches[0];
        const rect = img.getBoundingClientRect();
        const x = touch.clientX - rect.left;
        const y = touch.clientY - rect.top;
        const xPercent = (x / rect.width) * 100;
        const yPercent = (y / rect.height) * 100;
        
        img.style.transformOrigin = `${xPercent}% ${yPercent}%`;
    }


    document.querySelectorAll('.slide-zoom').forEach(slide => {
        
        slide.addEventListener('touchstart', (e) => {
            if (window.innerWidth >= 768) return; // Aumentado para 768px (md) para desativar no Desktop

            if (e.touches.length === 2) {
                // ** Pin√ßar (Pinch-to-Zoom) - PRIM√ÅRIO **
                e.preventDefault(); 
                
                initialPinchDistance = getDistance(e.touches[0], e.touches[1]);
                currentScale = 1; 
                imgElement = slide.querySelector('img');

                slide.classList.add('touch-zoom-active', 'swiper-no-swiping');
                
            } else if (e.touches.length === 1) {
                // ** Duplo Toque - APENAS RESET **
                const lastTapTime = touchTimestamps.get(slide) || 0;
                const currentTime = new Date().getTime();

                if (currentTime - lastTapTime < doubleTapDelay) {
                    e.preventDefault(); 
                    e.stopPropagation(); 
                    
                    const img = slide.querySelector('img');
                    
                    const style = window.getComputedStyle(img);
                    const matrix = style.transform === 'none' ? [1, 0, 0, 1, 0, 0] : style.transform.match(/matrix.*\((.+)\)/)[1].split(',').map(Number);
                    const currentVisualScale = matrix[0];

                    if (currentVisualScale > 1.05) { 
                        resetZoom(slide); 
                    }
                    
                    touchTimestamps.set(slide, 0); 
                } else {
                    touchTimestamps.set(slide, currentTime);
                }
            }
        }, { passive: false }); 

        slide.addEventListener('touchmove', (e) => {
            if (window.innerWidth >= 768) return;

            if (e.touches.length === 2 && initialPinchDistance > 0) {
                // ** Pin√ßar (Pinch-to-Zoom) - Movimento **
                e.preventDefault(); 
                e.stopPropagation();

                const newDistance = getDistance(e.touches[0], e.touches[1]);
                let scaleChange = newDistance / initialPinchDistance;
                let newScale = Math.max(1, Math.min(scaleChange, 4)); 

                if (imgElement) {
                    imgElement.style.transform = `scale(${newScale})`;
                    
                    const centerX = (e.touches[0].clientX + e.touches[1].clientX) / 2;
                    const centerY = (e.touches[0].clientY + e.touches[1].clientY) / 2;
                    
                    const rect = imgElement.getBoundingClientRect();
                    const x = centerX - rect.left;
                    const y = centerY - rect.top;
                    const xPercent = (x / rect.width) * 100;
                    const yPercent = (y / rect.height) * 100;
                    imgElement.style.transformOrigin = `${xPercent}% ${yPercent}%`;
                }
                
                currentScale = newScale;

            } else if (e.touches.length === 1 && (slide.classList.contains('touch-zoom-active') || slide.classList.contains('swiper-no-swiping'))) {
                // Pan (movimento de zoom)
                handleZoomPan(e); 
            }
        }, { passive: false });

        slide.addEventListener('touchend', (e) => {
            if (window.innerWidth >= 768) return;

            // Fim do Pinch
            if (slide.classList.contains('touch-zoom-active')) {
                 slide.classList.remove('touch-zoom-active'); 
                 slide.removeEventListener('touchmove', handleZoomPan, { passive: false });

                 if (currentScale < 1.3) {
                     resetZoom(slide);
                 } else {
                     slide.classList.add('swiper-no-swiping'); 
                 }
            }
            
            initialPinchDistance = 0;
            imgElement = null;
        });


        // ----------------------------------------------------
        // DESKTOP ZOOM (Hover/Mousemove) - Lupa
        // ----------------------------------------------------
        slide.addEventListener('mousemove', (e) => {
            if (window.innerWidth >= 768) {
                const img = e.currentTarget.querySelector('img');
                const rect = img.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                const xPercent = (x / rect.width) * 100;
                const yPercent = (y / rect.height) * 100;
                img.style.transformOrigin = `${xPercent}% ${yPercent}%`;
            }
        });

        slide.addEventListener('mouseleave', (e) => {
            if (window.innerWidth >= 768) {
                 e.currentTarget.querySelector('img').style.transformOrigin = '';
            }
        });
    });
    
    // ** 5. L√≥gica do Modal (MOBILE ONLY) **
    function openModal(id) { 
        if (window.innerWidth >= 768) return; // BLOQUEIA ABERTURA NO DESKTOP
        document.getElementById('modal1').classList.remove('bottom-0'); 
        document.getElementById('modal2').classList.remove('bottom-0'); 
        document.getElementById('modal' + id).classList.add('bottom-0'); 
    }
    function closeModal() { 
        document.getElementById('modal1').classList.remove('bottom-0'); 
        document.getElementById('modal2').classList.remove('bottom-0'); 
    }

    document.getElementById('modal1').addEventListener('click', e => { if(e.target === e.currentTarget) closeModal(); });
    document.getElementById('modal2').addEventListener('click', e => { if(e.target === e.currentTarget) closeModal(); });

    window.openModal = openModal;
    window.closeModal = closeModal;

    // Trigger inicial de renderiza√ß√£o no Desktop, caso a tela j√° seja grande
    window.addEventListener('resize', () => {
        if (window.innerWidth >= 768) {
             const activeSlide = verticalSwiper.slides[verticalSwiper.activeIndex];
             const productId = activeSlide.getAttribute('data-product-id');
             renderDetailsPanel(productId);
        }
    });

  </script>
</body>
</html>