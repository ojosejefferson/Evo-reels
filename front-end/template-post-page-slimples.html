<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EVO Reels - Template Modo Conte√∫do (Post/Page)</title>
  
  <!-- Inclui o Tailwind CSS via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Inclui os estilos do Swiper -->
  <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css" />
  
  <style>
    /* * CSS Customizado: Necess√°rio para Spinner, Pagina√ß√£o, e Scrubber Handle */
    * { margin:0; padding:0; box-sizing:border-box; }

    /* Estilos base para garantir 100% de altura/largura em dispositivos m√≥veis */
    body, html { 
      height: 100%; 
      width: 100%;
      background: #000; 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
      overflow: hidden;
    }
    
    /* * Spinner: O indicador de carregamento. */
    .spinner {
      border-top-color: #fff;
      -webkit-animation: spinner 1s linear infinite;
      animation: spinner 1s linear infinite;
    }
    @-webkit-keyframes spinner {
      0% { -webkit-transform: rotate(0deg); }
      100% { -webkit-transform: rotate(360deg); }
    }
    @keyframes spinner {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Barra de progresso do v√≠deo (Container para clique) */
    .evo-reels-video-progress {
      position: absolute; 
      bottom: 9px; 
      left: 20px; 
      right: 20px;
      height: 10px;
      background: transparent;
      z-index: 20; 
      cursor: pointer;
      padding-top: 3.5px;
    }
    /* Linha visual do progresso */
    .evo-reels-progress-line {
      height: 3px; 
      background: rgba(255,255,255,0.3); 
      border-radius: 2px;
      position: relative;
    }
    .evo-reels-progress-fill {
      width: 0%; 
      height: 100%; 
      background: white; 
      border-radius: 2px;
      transition: width 0.1s linear;
    }
    /* Handle visual (Bolha) */
    .evo-reels-progress-handle {
        position: absolute;
        top: 50%;
        left: 0;
        transform: translate(-50%, -50%);
        width: 10px; 
        height: 10px;
        background: white;
        border-radius: 50%;
        opacity: 0;
        transition: opacity 0.1s;
    }


    /* Estilos de zoom de lupa (Desktop: Hover/Mousemove) */
    .slide-zoom img {
      transition: transform 0.4s ease;
      transform-origin: center center;
    }
    /* Desktop: Zoom ativado por HOVER */
    .slide-zoom:hover img {
        transform: scale(2.2);
    }
    
    /* ** MELHORIA: Destaque e Z-INDEX da Pagina√ß√£o ** */
    .swiper-pagination-horizontal.swiper-pagination-bullets {
        bottom: 140px; 
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        justify-content: center;
        gap: 9px;
        z-index: 30; 
        position: absolute;
    }
    .swiper-pagination-bullet {
        width: 10px; 
        height: 10px; 
        background: rgba(255,255,255,0.5); 
        opacity: 1;
        transition: all 0.3s;
    }
    .swiper-pagination-bullet-active {
        background: white; 
        transform: scale(1.3); 
        border: 1px solid rgba(0,0,0,0.2);
    }
    /* Estilo do modal customizado (mantido para classes modais) */
    .modal.bottom-0 { bottom: 0; }
  </style>
</head>
<body class="bg-black text-white">

  <!-- ** Swiper Vertical (Feed) ** -->
  <div class="swiper evo-reels-vertical-swiper w-full h-full relative overflow-hidden 
              md:w-[384px] md:h-[683px] md:rounded-[36px] md:shadow-2xl md:shadow-black/70" id="evo-reels-vertical-swiper">
    <div class="swiper-wrapper">
      
      <!-- ** Slide Vertical 1: Post/Page 1 (Jaqueta Branca) ** -->
      <div class="swiper-slide evo-reels-reel-container w-full h-full relative" data-is-video="true">
        
        <!-- BARRA DE PROGRESSO DO V√çDEO (Fixa no slide do v√≠deo) -->
        <div class="evo-reels-video-progress" id="evo-reels-video-progress-1">
          <div class="evo-reels-progress-line">
              <div class="evo-reels-progress-fill" id="evo-reels-progress-fill-1"></div>
              <div class="evo-reels-progress-handle" id="evo-reels-progress-handle-1"></div>
          </div>
        </div>
        
        <div class="swiper evo-reels-horizontal-swiper w-full h-full relative" id="evo-reels-horizontal-swiper-1">
          <div class="swiper-wrapper">
            
            <!-- Slide Horizontal 1: V√≠deo -->
            <div class="swiper-slide evo-reels-video-slide relative">
              
              <!-- Indicador de Carregamento -->
              <div class="loading-indicator absolute inset-0 flex items-center justify-center bg-black/60 transition-opacity duration-300 z-10" id="loading-1">
                <div class="spinner border-4 border-gray-700 border-solid h-10 w-10 rounded-full"></div>
              </div>
              
              <video id="evo-reels-video-1" preload="metadata" loop playsinline muted class="w-full h-full object-cover">
                <source src="https://maksantos.com.br/wp-content/uploads/2024/12/VIDEO-MAKSANTOS-REELS-32-.mp4" type="video/mp4">
              </video>
              <div class="play-pause-overlay absolute inset-0 z-10 cursor-pointer" id="evo-reels-video-overlay-1"></div>
              <div class="play-pause-btn absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-16 h-16 bg-black/60 backdrop-blur-md rounded-full flex items-center justify-center text-white text-3xl opacity-0 transition-opacity duration-300 pointer-events-none z-10" id="evo-reels-play-pause-btn-1">Pause</div>
            </div>
            
            <!-- Slides Horizontal 2, 3, 4: Fotos com zoom lupa -->
            <div class="swiper-slide slide-zoom cursor-crosshair relative"><img src="https://agweb.co.in/fashion-hub/images/white-top-with-jacket.jpeg" alt="Foto 1" class="w-full h-full object-cover"></div>
            <div class="swiper-slide slide-zoom cursor-crosshair relative"><img src="https://agweb.co.in/fashion-hub/images/white-top-with-jacket.jpeg" alt="Foto 2" class="w-full h-full object-cover"></div>
            <div class="swiper-slide slide-zoom cursor-crosshair relative"><img src="https://agweb.co.in/fashion-hub/images/white-top-with-jacket.jpeg" alt="Foto 3" class="w-full h-full object-cover"></div>
            
          </div>
          <!-- Pontinhos (Pagina√ß√£o Horizontal) -->
          <div class="swiper-pagination"></div>
        </div>
        
        <!-- Overlays (Controlos e Informa√ß√µes) -->
        <div class="top-controls absolute top-4 right-4 flex gap-3 z-30">
          <button class="control-btn w-11 h-11 bg-black/70 backdrop-blur-sm rounded-full flex items-center justify-center text-white text-xl cursor-pointer border-none" id="evo-reels-sound-btn-1" onclick="toggleSound(1)">Volume Off</button>
          <button class="control-btn w-11 h-11 bg-black/70 backdrop-blur-sm rounded-full flex items-center justify-center text-white text-xl cursor-pointer border-none" onclick="window.close()">X</button>
        </div>
        
        <div class="overlay absolute inset-0 p-5 flex flex-col justify-between bg-gradient-to-t from-black/80 via-transparent/40 to-transparent text-white pointer-events-none z-10">
          <div class="top"><h4 class="text-xl font-semibold pointer-events-auto">Artigo do Blog</h4></div>
          <div class="actions absolute right-4 bottom-28 flex flex-col gap-6 pointer-events-auto z-20">
            <!-- CTA: A√ß√£o principal removida (COMPRAR) -->
            <div><button class="btn read-more bg-white text-black font-bold text-xs rounded-lg w-20 h-12 flex items-center justify-center border-none" onclick="readMore(1)">VER DETALHES</button></div>
            <div><button class="btn bg-white/10 backdrop-blur-md border border-white/20 w-14 h-14 rounded-full flex items-center justify-center text-xl">‚ù§Ô∏è</button><div class="count text-xs text-center mt-1">8.2K</div></div>
            <div><button class="btn bg-white/10 backdrop-blur-md border border-white/20 w-14 h-14 rounded-full flex items-center justify-center text-xl">üí¨</button><div class="count text-xs text-center mt-1">655K</div></div>
            <div><button class="btn bg-white/10 backdrop-blur-md border border-white/20 w-14 h-14 rounded-full flex items-center justify-center text-xl">üîó</button><div class="count text-xs text-center mt-1">8.2K</div></div>
          </div>
          <div class="footer pointer-events-auto cursor-pointer z-20" onclick="openModal(1)">
            <div class="profile flex items-center gap-2 mb-1">
              <img src="https://agweb.co.in/images/portfolio/favicon/apple-icon-60x60.png" alt="Profile" class="w-9 h-9 rounded-full border-2 border-white">
              <div>
                <!-- Titulo do Post/Page -->
                <div class="product-name font-bold text-base">Os 5 Segredos de um Look Minimalista</div>
                <!-- Pre√ßo removido -->
              </div>
            </div>
            <div class="desc text-sm leading-snug opacity-90 mt-1">Aprenda a otimizar seu guarda-roupa com pe√ßas-chave e estilo.</div>
          </div>
        </div>
      </div>
      
      <!-- ** Slide Vertical 2: Post/Page 2 (T√™nis Vermelho) ** -->
      <div class="swiper-slide evo-reels-reel-container w-full h-full relative" data-is-video="false">
        <div class="swiper evo-reels-horizontal-swiper w-full h-full relative" id="evo-reels-horizontal-swiper-2">
          <div class="swiper-wrapper">
            
            <!-- Slides Horizontal: Apenas Imagens para o segundo produto -->
            <div class="swiper-slide slide-zoom cursor-crosshair relative">
                <!-- Indicador de Carregamento -->
                <div class="loading-indicator absolute inset-0 flex items-center justify-center bg-black/60 transition-opacity duration-300 z-10" id="loading-2">
                    <div class="spinner border-4 border-gray-700 border-solid h-10 w-10 rounded-full"></div>
                </div>
                <img src="https://images.unsplash.com/photo-1542291026-7eec264c27fc?q=80&w=2670&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="T√™nis Vermelho 1" class="w-full h-full object-cover">
            </div>
            <div class="swiper-slide slide-zoom cursor-crosshair relative">
                <!-- Indicador de Carregamento -->
                <div class="loading-indicator absolute inset-0 flex items-center justify-center bg-black/60 transition-opacity duration-300 z-10" id="loading-3">
                    <div class="spinner border-4 border-gray-700 border-solid h-10 w-10 rounded-full"></div>
                </div>
                <img src="https://images.unsplash.com/photo-1605342415174-8d4ed0c5c364?q=80&w=2670&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="T√™nis Vermelho 2" class="w-full h-full object-cover">
            </div>
            
          </div>
          <!-- Pontinhos (Pagina√ß√£o Horizontal) -->
          <div class="swiper-pagination"></div>
        </div>
        
        <!-- Overlays (Controlos e Informa√ß√µes) -->
        <div class="top-controls absolute top-4 right-4 flex gap-3 z-30">
            <button class="control-btn w-11 h-11 bg-black/70 backdrop-blur-sm rounded-full flex items-center justify-center text-white text-xl cursor-pointer border-none">X</button>
        </div>
        <div class="overlay absolute inset-0 p-5 flex flex-col justify-between bg-gradient-to-t from-black/80 via-transparent/40 to-transparent text-white pointer-events-none z-10">
          <div class="top"><h4 class="text-xl font-semibold pointer-events-auto">Landing Page</h4></div>
          <div class="actions absolute right-4 bottom-28 flex flex-col gap-6 pointer-events-auto z-20">
            <!-- CTA: A√ß√£o principal removida (COMPRAR) -->
            <div><button class="btn read-more bg-white text-black font-bold text-xs rounded-lg w-20 h-12 flex items-center justify-center border-none" onclick="readMore(2)">LER MAIS</button></div>
            <div><button class="btn bg-white/10 backdrop-blur-md border border-white/20 w-14 h-14 rounded-full flex items-center justify-center text-xl">‚ù§Ô∏è</button><div class="count text-xs text-center mt-1">12.5K</div></div>
            <div><button class="btn bg-white/10 backdrop-blur-md border border-white/20 w-14 h-14 rounded-full flex items-center justify-center text-xl">üí¨</button><div class="count text-xs text-center mt-1">980</div></div>
            <div><button class="btn bg-white/10 backdrop-blur-md border border-white/20 w-14 h-14 rounded-full flex items-center justify-center text-xl">üîó</button><div class="count text-xs text-center mt-1">5.1K</div></div>
          </div>
          <div class="footer pointer-events-auto cursor-pointer z-20" onclick="openModal(2)">
            <div class="profile flex items-center gap-2 mb-1">
              <img src="https://agweb.co.in/images/portfolio/favicon/apple-icon-60x60.png" alt="Profile" class="w-9 h-9 rounded-full border-2 border-white">
              <div>
                <!-- Titulo do Post/Page -->
                <div class="product-name font-bold text-base">Guia Definitivo do T√™nis Casual</div>
                <!-- Pre√ßo removido -->
              </div>
            </div>
            <div class="desc text-sm leading-snug opacity-90 mt-1">Descubra os melhores modelos para conforto e estilo urbano.</div>
          </div>
        </div>
      </div>
      
    </div>
  </div>
  
  <!-- Modal 1 (Jaqueta / Conte√∫do) -->
  <div class="modal fixed bottom-[-100%] left-1/2 -translate-x-1/2 w-full max-w-[384px] max-h-[90vh] bg-white rounded-t-[32px] p-5 transition-all duration-400 ease-in-out shadow-xl z-[999] overflow-y-auto" id="modal1">
    <div class="flex justify-between items-center pb-2">
      <button class="back-btn bg-none border-none text-xl cursor-pointer p-2 font-bold" onclick="closeModal()">‚úï</button>
    </div>
    <div class="drag-bar w-10 h-1.5 bg-gray-300 rounded-md mx-auto my-2"></div>
    <img src="https://agweb.co.in/fashion-hub/images/white-top-with-jacket.jpeg" class="modal-img w-full h-[340px] object-cover rounded-xl mb-4" alt="Jaqueta">
    <h3 class="modal-title text-2xl font-bold mb-2">Os 5 Segredos de um Look Minimalista</h3>
    <!-- Pre√ßo removido -->
    <p class="modal-desc text-base leading-relaxed text-gray-600 mb-8">Conte√∫do: Aprenda a otimizar seu guarda-roupa com pe√ßas-chave e estilo. Tecido premium italiano, acabamento perfeito. Frete gr√°tis acima de R$299 ‚Ä¢ Parcelamento em at√© 12x.</p>
    <button class="cta-btn bg-indigo-600 text-white border-none py-4 rounded-full text-lg font-bold w-full cursor-pointer" onclick="readMore(1)">LER MAIS</button>
  </div>

  <!-- Modal 2 (T√™nis / Conte√∫do) -->
  <div class="modal fixed bottom-[-100%] left-1/2 -translate-x-1/2 w-full max-w-[384px] max-h-[90vh] bg-white rounded-t-[32px] p-5 transition-all duration-400 ease-in-out shadow-xl z-[999] overflow-y-auto" id="modal2">
    <div class="flex justify-between items-center pb-2">
      <button class="back-btn bg-none border-none text-xl cursor-pointer p-2 font-bold" onclick="closeModal()">‚úï</button>
    </div>
    <div class="drag-bar w-10 h-1.5 bg-gray-300 rounded-md mx-auto my-2"></div>
    <img src="https://images.unsplash.com/photo-1542291026-7eec264c27fc?q=80&w=2670&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" class="modal-img w-full h-[340px] object-cover rounded-xl mb-4" alt="T√™nis">
    <h3 class="modal-title text-2xl font-bold mb-2">Guia Definitivo do T√™nis Casual</h3>
    <!-- Pre√ßo removido -->
    <p class="modal-desc text-base leading-relaxed text-gray-600 mb-8">Conte√∫do: Descubra os melhores modelos para conforto e estilo urbano. Lan√ßamento da cole√ß√£o, solado com tecnologia de amortecimento e design moderno.</p>
    <button class="cta-btn bg-indigo-600 text-white border-none py-4 rounded-full text-lg font-bold w-full cursor-pointer" onclick="readMore(2)">VER DETALHES</button>
  </div>

  <!-- Inclui o script do Swiper -->
  <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
  
  <script>
    // ** Vari√°veis Globais (Renomeadas com Prefixo) **
    const video = document.getElementById('evo-reels-video-1');
    const progressFill = document.getElementById('evo-reels-progress-fill-1');
    const progressHandle = document.getElementById('evo-reels-progress-handle-1');
    const videoOverlay = document.getElementById('evo-reels-video-overlay-1');
    const playPauseBtn = document.getElementById('evo-reels-play-pause-btn-1');
    const soundBtn = document.getElementById('evo-reels-sound-btn-1');
    const videoProgressContainer = document.getElementById('evo-reels-video-progress-1');
    
    // ** Vari√°veis de Zoom/Touch **
    const touchTimestamps = new WeakMap();
    const doubleTapDelay = 300; 
    let initialPinchDistance = 0;
    let currentScale = 1;
    let imgElement = null;

    // Fun√ß√£o auxiliar para simular a√ß√£o de leitura
    function readMore(id) {
        // No plugin real, esta fun√ß√£o seria um AJAX call para registrar o clique (Analytics)
        // e, em seguida, redirecionar para a URL permanente do post/page
        console.log("A√ß√£o CTA disparada! Redirecionando para o Post ID: " + id);
        // Exemplo: window.location.href = `https://seusite.com/postagem-${id}`;
        alert("Simulando redirecionamento para o Post/Page ID: " + id);
    }
    window.readMore = readMore; // Expondo para o HTML
    
    // Fun√ß√µes de suporte (getDistance, hideLoading, etc. omitidas por brevidade, mas mantidas no HTML)
    function getDistance(touch1, touch2) {
        return Math.sqrt(
            Math.pow(touch2.clientX - touch1.clientX, 2) +
            Math.pow(touch2.clientY - touch1.clientY, 2)
        );
    }

    function hideLoading(id) {
        const indicator = document.getElementById('loading-' + id);
        if (indicator) {
            indicator.classList.add('opacity-0');
            setTimeout(() => indicator.style.display = 'none', 300);
        }
    }

    // Ocultar spinners de imagem ao carregar
    document.querySelectorAll('.slide-zoom img').forEach((img, index) => {
        const loadingId = index + 2; 
        img.addEventListener('load', () => hideLoading(loadingId));
    });

    // Ocultar spinner do v√≠deo
    if(video) video.addEventListener('canplaythrough', () => hideLoading(1));

    // ** 1. Configura√ß√£o do Swiper Vertical (Feed de Reels) **
    const verticalSwiper = new Swiper('#evo-reels-vertical-swiper', {
      direction: 'vertical',
      slidesPerView: 1,
      spaceBetween: 0,
      mousewheel: true,
      keyboard: { enabled: true },
      on: {
        slideChangeTransitionStart: function() {
          if (this.previousIndex === 0 && video) {
            video.pause();
            videoProgressContainer.style.display = 'none'; 
          }
        },
        slideChangeTransitionEnd: function() {
          if (this.activeIndex === 0 && video) {
            video.currentTime = 0;
            video.play().catch(e => console.log("V√≠deo n√£o p√¥de ser reproduzido automaticamente."));
            video.muted = (soundBtn.textContent === "Volume Off");
            videoProgressContainer.style.display = 'block'; 
          } else {
             if(videoProgressContainer) videoProgressContainer.style.display = 'none'; 
          }
          
          const currentHorizontalSwiper = this.slides[this.activeIndex].querySelector('.evo-reels-horizontal-swiper').swiper;
          if (currentHorizontalSwiper) {
             currentHorizontalSwiper.slideTo(0);
          }
        },
      }
    });

    // ** 2. Configura√ß√£o do Swiper Horizontal (Imagens/V√≠deos de um Reel) **
    document.querySelectorAll('.evo-reels-horizontal-swiper').forEach(function(element) {
      new Swiper(element, {
        slidesPerView: 1,
        spaceBetween: 0,
        pagination: {
          el: element.querySelector(".swiper-pagination"),
          clickable: true,
        },
        keyboard: { enabled: true },
        on: {
          slideChange: function() {
            if (verticalSwiper.activeIndex === 0 && video) {
              if (this.activeIndex === 0) {
                video.currentTime = 0;
                video.play();
                videoProgressContainer.style.opacity = 1;
              } else {
                video.pause();
                videoProgressContainer.style.opacity = 0;
              }
            }
            
            const prevSlide = this.slides[this.previousIndex];
            if (prevSlide && prevSlide.classList.contains('slide-zoom')) {
                 resetZoom(prevSlide); 
            }
          }
        }
      });
    });

    // ** 3. L√≥gica do V√≠deo **
    if(video) {
        video.muted = true;
        video.play().catch(e => console.log("V√≠deo n√£o p√¥de ser reproduzido automaticamente."));

        video.addEventListener('timeupdate', () => {
          if (video.duration && progressFill && progressHandle) {
            const percent = (video.currentTime / video.duration) * 100;
            progressFill.style.width = percent + '%';
            progressHandle.style.left = percent + '%';
          }
        });
        
        // Fun√ß√£o unificada para Seeking (Avan√ßar/Retroceder)
        function handleVideoSeeking(e) {
            const clientX = e.clientX || (e.changedTouches && e.changedTouches[0].clientX);
            if (!clientX || !videoProgressContainer) return;

            const rect = videoProgressContainer.getBoundingClientRect();
            const percent = (clientX - rect.left) / rect.width;
            
            if (video.duration) {
                video.currentTime = percent * video.duration;
            }
        }

        // Eventos de seek
        if (videoProgressContainer) {
            videoProgressContainer.addEventListener('mousedown', () => progressHandle.style.opacity = 1);
            videoProgressContainer.addEventListener('touchstart', () => progressHandle.style.opacity = 1);
            videoProgressContainer.addEventListener('click', handleVideoSeeking);
            videoProgressContainer.addEventListener('touchend', (e) => {
                handleVideoSeeking(e);
                progressHandle.style.opacity = 0;
            });
            videoProgressContainer.addEventListener('mouseup', () => progressHandle.style.opacity = 0);
        }

        videoOverlay.addEventListener('click', (e) => {
          e.stopPropagation();
          if (video.paused) {
            video.play();
            playPauseBtn.textContent = 'Pause';
          } else {
            video.pause();
            playPauseBtn.textContent = 'Play';
          }
          playPauseBtn.classList.add('opacity-100');
          setTimeout(() => playPauseBtn.classList.remove('opacity-100'), 800);
        });

        // Controle de Som
        function toggleSound(id) {
            const targetVideo = document.getElementById('evo-reels-video-' + id);
            const targetBtn = document.getElementById('evo-reels-sound-btn-' + id);
            if (targetVideo) {
                targetVideo.muted = !targetVideo.muted;
                targetBtn.textContent = targetVideo.muted ? "Volume Off" : "Volume On";
            }
        }
        window.toggleSound = toggleSound;
    }

    // ** 4. L√≥gica do Zoom (Universal - adaptada do c√≥digo anterior) **
    
    function resetZoom(parentSlide) {
        const img = parentSlide.querySelector('img');
        
        parentSlide.classList.remove('touch-zoom-active', 'touch-zoom-active-fixed');
        parentSlide.classList.remove('swiper-no-swiping'); 
        
        if (img) {
            img.style.transform = 'scale(1)'; 
            img.style.transformOrigin = '';
        }

        parentSlide.removeEventListener('touchmove', handleZoomPan, { passive: false });
        currentScale = 1;
        initialPinchDistance = 0;
        imgElement = null;
    }

    function handleZoomPan(e) {
        if (e.touches.length !== 1 || !(e.currentTarget.classList.contains('touch-zoom-active') || e.currentTarget.classList.contains('swiper-no-swiping'))) return;

        e.preventDefault(); 
        e.stopPropagation();

        const parentSlide = e.currentTarget;
        const img = parentSlide.querySelector('img');
        if (!img) return;

        const touch = e.touches[0];
        const rect = img.getBoundingClientRect();
        const x = touch.clientX - rect.left;
        const y = touch.clientY - rect.top;
        const xPercent = (x / rect.width) * 100;
        const yPercent = (y / rect.height) * 100;
        
        img.style.transformOrigin = `${xPercent}% ${yPercent}%`;
    }

    document.querySelectorAll('.slide-zoom').forEach(slide => {
        
        slide.addEventListener('touchstart', (e) => {
            if (window.innerWidth >= 450) return; 

            if (e.touches.length === 2) {
                e.preventDefault(); 
                initialPinchDistance = getDistance(e.touches[0], e.touches[1]);
                currentScale = 1; 
                imgElement = slide.querySelector('img');
                slide.classList.add('touch-zoom-active', 'swiper-no-swiping');
                
            } else if (e.touches.length === 1) {
                const lastTapTime = touchTimestamps.get(slide) || 0;
                const currentTime = new Date().getTime();

                if (currentTime - lastTapTime < doubleTapDelay) {
                    e.preventDefault(); 
                    e.stopPropagation(); 
                    const img = slide.querySelector('img');
                    if(img) {
                        const style = window.getComputedStyle(img);
                        const matrix = style.transform === 'none' ? [1, 0, 0, 1, 0, 0] : style.transform.match(/matrix.*\((.+)\)/)[1].split(',').map(Number);
                        const currentVisualScale = matrix[0];

                        if (currentVisualScale > 1.05) { 
                            resetZoom(slide); 
                        }
                    }
                    touchTimestamps.set(slide, 0); 
                } else {
                    touchTimestamps.set(slide, currentTime);
                }
            }
        }, { passive: false }); 

        slide.addEventListener('touchmove', (e) => {
            if (window.innerWidth >= 450) return;

            if (e.touches.length === 2 && initialPinchDistance > 0) {
                e.preventDefault(); 
                e.stopPropagation();

                const newDistance = getDistance(e.touches[0], e.touches[1]);
                let newScale = Math.max(1, Math.min(newDistance / initialPinchDistance, 4)); 

                if (imgElement) {
                    imgElement.style.transform = `scale(${newScale})`;
                    
                    const centerX = (e.touches[0].clientX + e.touches[1].clientX) / 2;
                    const centerY = (e.touches[0].clientY + e.touches[1].clientY) / 2;
                    
                    const rect = imgElement.getBoundingClientRect();
                    const x = centerX - rect.left;
                    const y = centerY - rect.top;
                    const xPercent = (x / rect.width) * 100;
                    const yPercent = (y / rect.height) * 100;
                    imgElement.style.transformOrigin = `${xPercent}% ${yPercent}%`;
                }
                
                currentScale = newScale;

            } else if (e.touches.length === 1 && (slide.classList.contains('touch-zoom-active') || slide.classList.contains('swiper-no-swiping'))) {
                handleZoomPan(e); 
            }
        }, { passive: false });

        slide.addEventListener('touchend', (e) => {
            if (window.innerWidth >= 450) return;

            if (slide.classList.contains('touch-zoom-active')) {
                 slide.classList.remove('touch-zoom-active'); 
                 slide.removeEventListener('touchmove', handleZoomPan, { passive: false });

                 if (currentScale < 1.3) {
                     resetZoom(slide);
                 } else {
                     slide.classList.add('swiper-no-swiping'); 
                 }
            }
            
            initialPinchDistance = 0;
            imgElement = null;
        });
    });
    
    // ** 5. L√≥gica do Modal **
    function openModal(id) { 
        document.getElementById('modal1').classList.remove('bottom-[-100%]'); 
        document.getElementById('modal2').classList.remove('bottom-[-100%]'); 
        document.getElementById('modal' + id).classList.add('bottom-0'); 
    }
    function closeModal() { 
        document.getElementById('modal1').classList.remove('bottom-0'); 
        document.getElementById('modal2').classList.remove('bottom-0'); 
        document.getElementById('modal1').classList.add('bottom-[-100%]'); 
        document.getElementById('modal2').classList.add('bottom-[-100%]'); 
    }

    document.getElementById('modal1').addEventListener('click', e => { if(e.target === e.currentTarget) closeModal(); });
    document.getElementById('modal2').addEventListener('click', e => { if(e.target === e.currentTarget) closeModal(); });

    window.openModal = openModal;
    window.closeModal = closeModal;
  </script>
</body>
</html>